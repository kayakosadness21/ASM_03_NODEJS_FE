{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ADMIN\\\\Documents\\\\Project3nodejs20.1.24\\\\frontend\\\\FE-ecommerce\\\\src\\\\components\\\\chat\\\\messenger.js\",\n  _s = $RefreshSig$();\nimport { useEffect, useRef, useState } from \"react\";\nimport MessengerWindow from \"./messenger-window\";\nimport classes from \"./messenger.module.css\";\nimport openSocket from \"socket.io-client\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { createChatRoomAPI } from \"../lib/api-chat\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Messenger = () => {\n  _s();\n  const [chatToggle, setChatToggle] = useState(false);\n  const [socket, setSocket] = useState(null);\n  const refSocket = useRef();\n  refSocket.current = socket;\n  const {\n    chatRoomId\n  } = useSelector(state => state.chatReducer);\n  const [adminTyping, setAdminTyping] = useState();\n  const dispatch = useDispatch();\n\n  // componentDidMout - connect to server, create room\n  useEffect(() => {\n    // open socket\n    setSocket(openSocket(`${process.env.REACT_APP_DOMAIN}`));\n    if (!chatRoomId) {\n      dispatch(createChatRoomAPI());\n    }\n    const cleanup = e => {\n      e.preventDefault();\n      dispatch({\n        type: \"CLEAR_CHAT\"\n      });\n      // return (e.returnValue = \"Close tab\");\n    };\n\n    window.addEventListener(\"beforeunload\", cleanup);\n    return () => {\n      var _refSocket$current;\n      window.removeEventListener(\"beforeunload\", cleanup);\n      console.log(\"CHECK DISCONNECT: \", refSocket.current);\n      (_refSocket$current = refSocket.current) === null || _refSocket$current === void 0 ? void 0 : _refSocket$current.disconnect();\n    };\n  }, []);\n\n  // componentDidUpdate - listen channel after get chatRoomId\n  useEffect(() => {\n    // open channel with name is _id of chat room\n    if (socket && chatRoomId) {\n      socket.on(chatRoomId, data => {\n        if (data.action === \"reply\") {\n          dispatch({\n            type: \"ADD_MESSAGE\",\n            payload: {\n              user: \"admin\",\n              message: data.message\n            }\n          });\n        }\n        if (data.action === \"START_TYPING\") {\n          // console.log(\"CHECK typing start: \", data);\n          setAdminTyping(\"Admin is typing ...\");\n        } else {\n          // console.log(\"CHECK typing stop: \", data);\n          setAdminTyping(\"\");\n        }\n      });\n    }\n    chatRoomId && (socket === null || socket === void 0 ? void 0 : socket.emit(\"ONLINE_OFFLINE\", {\n      action: \"ONLINE\",\n      roomId: chatRoomId,\n      userId: \"client\"\n    }));\n  }, [chatRoomId, socket]);\n  const chatToggleHandler = () => {\n    setChatToggle(prvChatToggle => !prvChatToggle);\n  };\n  // console.log(\"CHECK SOCKT: \", socket);\n  const typingHandler = status => {\n    // console.log(\"CHECK CHOOSE ROOM: \", chooseRoom);\n    if (status === \"START\") {\n      socket === null || socket === void 0 ? void 0 : socket.emit(\"TYPING\", {\n        action: \"START_TYPING\",\n        roomId: chatRoomId,\n        userId: \"client\"\n      });\n      return;\n    }\n    if (status === \"STOP\") {\n      socket === null || socket === void 0 ? void 0 : socket.emit(\"TYPING\", {\n        action: \"STOP_TYPING\",\n        roomId: chatRoomId,\n        userId: \"client\"\n      });\n      console.log(\"stop type\");\n      return;\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: classes[\"messenger-container\"],\n    children: [chatToggle && /*#__PURE__*/_jsxDEV(MessengerWindow, {\n      adminTyping: adminTyping,\n      onTypingHandler: typingHandler\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: classes[\"messenger-icon\"],\n      children: /*#__PURE__*/_jsxDEV(\"svg\", {\n        xmlns: \"http://www.w3.org/2000/svg\",\n        viewBox: \"0 0 512 512\",\n        onClick: chatToggleHandler,\n        children: /*#__PURE__*/_jsxDEV(\"path\", {\n          d: \"M256.55 8C116.52 8 8 110.34 8 248.57c0 72.3 29.71 134.78 78.07 177.94 8.35 7.51 6.63 11.86 8.05 58.23A19.92 19.92 0 0 0 122 502.31c52.91-23.3 53.59-25.14 62.56-22.7C337.85 521.8 504 423.7 504 248.57 504 110.34 396.59 8 256.55 8zm149.24 185.13l-73 115.57a37.37 37.37 0 0 1-53.91 9.93l-58.08-43.47a15 15 0 0 0-18 0l-78.37 59.44c-10.46 7.93-24.16-4.6-17.11-15.67l73-115.57a37.36 37.36 0 0 1 53.91-9.93l58.06 43.46a15 15 0 0 0 18 0l78.41-59.38c10.44-7.98 24.14 4.54 17.09 15.62z\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 5\n  }, this);\n};\n_s(Messenger, \"s+MMqj9OQ1nQzWpCY3KXupIxCYw=\", false, function () {\n  return [useSelector, useDispatch];\n});\n_c = Messenger;\nexport default Messenger;\nvar _c;\n$RefreshReg$(_c, \"Messenger\");","map":{"version":3,"names":["useEffect","useRef","useState","MessengerWindow","classes","openSocket","useDispatch","useSelector","createChatRoomAPI","Messenger","chatToggle","setChatToggle","socket","setSocket","refSocket","current","chatRoomId","state","chatReducer","adminTyping","setAdminTyping","dispatch","process","env","REACT_APP_DOMAIN","cleanup","e","preventDefault","type","window","addEventListener","removeEventListener","console","log","disconnect","on","data","action","payload","user","message","emit","roomId","userId","chatToggleHandler","prvChatToggle","typingHandler","status"],"sources":["C:/Users/ADMIN/Documents/Project3nodejs20.1.24/frontend/FE-ecommerce/src/components/chat/messenger.js"],"sourcesContent":["import { useEffect, useRef, useState } from \"react\";\r\nimport MessengerWindow from \"./messenger-window\";\r\nimport classes from \"./messenger.module.css\";\r\nimport openSocket from \"socket.io-client\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { createChatRoomAPI } from \"../lib/api-chat\";\r\n\r\nconst Messenger = () => {\r\n  const [chatToggle, setChatToggle] = useState(false);\r\n  const [socket, setSocket] = useState(null);\r\n  const refSocket = useRef();\r\n  refSocket.current = socket;\r\n  const { chatRoomId } = useSelector((state) => state.chatReducer);\r\n  const [adminTyping, setAdminTyping] = useState();\r\n  const dispatch = useDispatch();\r\n\r\n  // componentDidMout - connect to server, create room\r\n  useEffect(() => {\r\n    // open socket\r\n    setSocket(openSocket(`${process.env.REACT_APP_DOMAIN}`));\r\n    if (!chatRoomId) {\r\n      dispatch(createChatRoomAPI());\r\n    }\r\n    const cleanup = (e) => {\r\n      e.preventDefault();\r\n      dispatch({ type: \"CLEAR_CHAT\" });\r\n      // return (e.returnValue = \"Close tab\");\r\n    };\r\n    window.addEventListener(\"beforeunload\", cleanup);\r\n    return () => {\r\n      window.removeEventListener(\"beforeunload\", cleanup);\r\n      console.log(\"CHECK DISCONNECT: \", refSocket.current);\r\n      refSocket.current?.disconnect();\r\n    };\r\n  }, []);\r\n\r\n  // componentDidUpdate - listen channel after get chatRoomId\r\n  useEffect(() => {\r\n    // open channel with name is _id of chat room\r\n    if (socket && chatRoomId) {\r\n      socket.on(chatRoomId, (data) => {\r\n        if (data.action === \"reply\") {\r\n          dispatch({\r\n            type: \"ADD_MESSAGE\",\r\n            payload: { user: \"admin\", message: data.message },\r\n          });\r\n        }\r\n        if (data.action === \"START_TYPING\") {\r\n          // console.log(\"CHECK typing start: \", data);\r\n          setAdminTyping(\"Admin is typing ...\");\r\n        } else {\r\n          // console.log(\"CHECK typing stop: \", data);\r\n          setAdminTyping(\"\");\r\n        }\r\n      });\r\n    }\r\n    chatRoomId &&\r\n      socket?.emit(\"ONLINE_OFFLINE\", {\r\n        action: \"ONLINE\",\r\n        roomId: chatRoomId,\r\n        userId: \"client\",\r\n      });\r\n  }, [chatRoomId, socket]);\r\n\r\n  const chatToggleHandler = () => {\r\n    setChatToggle((prvChatToggle) => !prvChatToggle);\r\n  };\r\n  // console.log(\"CHECK SOCKT: \", socket);\r\n  const typingHandler = (status) => {\r\n    // console.log(\"CHECK CHOOSE ROOM: \", chooseRoom);\r\n    if (status === \"START\") {\r\n      socket?.emit(\"TYPING\", {\r\n        action: \"START_TYPING\",\r\n        roomId: chatRoomId,\r\n        userId: \"client\",\r\n      });\r\n      return;\r\n    }\r\n    if (status === \"STOP\") {\r\n      socket?.emit(\"TYPING\", {\r\n        action: \"STOP_TYPING\",\r\n        roomId: chatRoomId,\r\n        userId: \"client\",\r\n      });\r\n      console.log(\"stop type\");\r\n      return;\r\n    }\r\n  };\r\n  return (\r\n    <div className={classes[\"messenger-container\"]}>\r\n      {chatToggle && (\r\n        <MessengerWindow\r\n          adminTyping={adminTyping}\r\n          onTypingHandler={typingHandler}\r\n        />\r\n      )}\r\n      <div className={classes[\"messenger-icon\"]}>\r\n        <svg\r\n          xmlns=\"http://www.w3.org/2000/svg\"\r\n          viewBox=\"0 0 512 512\"\r\n          onClick={chatToggleHandler}\r\n        >\r\n          <path d=\"M256.55 8C116.52 8 8 110.34 8 248.57c0 72.3 29.71 134.78 78.07 177.94 8.35 7.51 6.63 11.86 8.05 58.23A19.92 19.92 0 0 0 122 502.31c52.91-23.3 53.59-25.14 62.56-22.7C337.85 521.8 504 423.7 504 248.57 504 110.34 396.59 8 256.55 8zm149.24 185.13l-73 115.57a37.37 37.37 0 0 1-53.91 9.93l-58.08-43.47a15 15 0 0 0-18 0l-78.37 59.44c-10.46 7.93-24.16-4.6-17.11-15.67l73-115.57a37.36 37.36 0 0 1 53.91-9.93l58.06 43.46a15 15 0 0 0 18 0l78.41-59.38c10.44-7.98 24.14 4.54 17.09 15.62z\" />\r\n        </svg>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Messenger;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}